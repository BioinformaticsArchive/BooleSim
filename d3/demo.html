<html>

<head>
	<script src="d3.v2.js"></script>
	<link type="text/css" rel="stylesheet" href="https://raw.github.com/mbostock/d3/master/examples/force/force.css"/>
	<script src="network.js"></script>
</head>

<body>
	<script>
	var	width = 960,
		height = 900;

	var color = d3.scale.category20();

	var force = d3.layout.force()
						.charge(-130)
						.linkDistance(10)
						.size([width, height]);

	var svg = d3.select("body").append("svg")
								.attr("width", width)
								.attr("height", height);

	network.links = network.edges;
	console.log(network.nodes.length+' nodes')
	console.log(network.links.length+' edges');

	for (i in network.nodes) {
		n = network.nodes[i];
		n.index = i;
		n.x = 10;
		n.y = 10;
		n.px = 1;
		n.py = 1;
		n.fixed = false;
		n.width = 1;
		}
/*
	function getNodeById(id) {
		for (i in network.nodes) {
			if (network.nodes[i].id == id || network.nodes[i] == id)
				return network.nodes[i];
			}
		console.error('node '+id+' not found');
		var n = network.nodes.append( {'index':network.nodes.length()} );
		return n;
		}

	for (i in network.edges) {
		network.edges[i].source = getNodeById(network.edges[i].source);
		network.edges[i].target = getNodeById(network.edges[i].target);
		network.edges[i].value = 1;
//		console.log(JSON.stringify(network.edges[i]));
		if (network.edges[i].source == null || network.edges[i].target == null)
			delete network.edges[i];
		}
*/
	  force
	      .nodes(network.nodes)
	      .links(network.edges)
	      .start();

	// link.source/target is expected as index of a node

	  var links = svg.selectAll("line.link")
							.data(network.edges).enter()
								.append("line")
								.attr("class", "link")
								.style("stroke-width", 1);
    
	  var nodes = svg.selectAll("rect.node")
							.data(network.nodes).enter()
								.append("rect")
								.attr("class", "node")
//								.attr("r", 5)
								.attr("width", "10")
								.attr("height", "10")
								.style("fill", "green")
								.call(force.drag);

	  nodes.append("title").text(
						function(n) { return n.id; }
						);

	  force.on("tick", function() {
						    links	.attr("x1", function(e) { return e.source.x; })
								.attr("y1", function(e) { return e.source.y; })
								.attr("x2", function(e) { return e.target.x; })
								.attr("y2", function(e) { return e.target.y; });

						    nodes	.attr("x", function(n) { return n.x; })
								.attr("y", function(n) { return n.y; });
						  });
	</script>
</body>

</html>