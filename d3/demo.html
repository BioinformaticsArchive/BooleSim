<html>

<head>
	<script src="d3.v2.js"></script>
	<script src="network.js"></script>
	<style>
	g {
	  stroke: #fff;
	  stroke-width: 1.5px;
	  fill: #008000;
	}
	line {
	  stroke: #999;
	  stroke-opacity: .6;
	}
	</style>
</head>

<body>
	<script>
	var	width = 960,
		height = 900;

	var color = d3.scale.category20();

	var force = d3.layout.force()
						.charge(-500)
						.linkDistance(50)
						.size([width, height]);

	var svg = d3.select("body").append("svg")
								.attr("width", width)
								.attr("height", height);

	console.log(network.nodes.length+' nodes')
	console.log(network.edges.length+' edges');

	for (i in network.nodes) {
		n = network.nodes[i];
		n.index = i;
		n.x = 10;
		n.y = 10;
		n.px = 1;
		n.py = 1;
		n.fixed = false;
		n.weight = 1;
		}

	function getNodeById(id) {
		for (i in network.nodes) {
			if (network.nodes[i].id == id || network.nodes[i] == id)
				return network.nodes[i];
			}
		console.error('node '+id+' not found. created.');
		return network.nodes.append( {'index':network.nodes.length, 'x':1, 'y':1, 'fixed':false} );
		}

	//
	// d3 expects edge source and targets specified as object links, rather than ids or indices
	//
	for (i in network.edges) {
		network.edges[i].sourceNode = getNodeById(network.edges[i].source);
		network.edges[i].targetNode = getNodeById(network.edges[i].target);
		}

	// import data to d3 force-directed layouting
	force
	      .nodes(network.nodes)
	      .links(network.edges)
	      .start();

	var links = svg.selectAll("line.link")
					.data(network.edges).enter()
						.append("line")
						.attr("class", "link")			// add class link for application of css style attributes
						.style("stroke-width", 2);
    
	var w = 70;
	var h = 30;
	var nodes = svg.selectAll("g").data(network.nodes)	// selectAll.data = apply the data in network.nodes to the selected svg elements, which already exist
										.enter()	// for remaining unapplied data do:
											.append("g");
	nodes	.attr("class", "bbox")
			.attr("width", w)
			.attr("height",  h);

	nodes	.call(force.drag);

	var circles =	nodes
					.append("rect")
					.attr("class", "node")
					.attr("fill", "green");

	var titles =	nodes
					.append("text")
					.text("test");

	  /*nodes.append("title").text(
						function(n) { return n.id; }
						);
						*/

	  force.on("tick", function() {
						    links	.attr("x1", function(data) { return data.sourceNode.x+w/2; })
								.attr("y1", function(data) { return data.sourceNode.y+h/2; })
								.attr("x2", function(data) { return data.targetNode.x+w/2; })
								.attr("y2", function(data) { return data.targetNode.y+h/2; });

						    circles	.attr("x", function(data) { return data.x; })
								.attr("y", function(data) { return data.y; });

						    titles	.attr("x", function(data) { return data.x; })
								.attr("y", function(data) { return data.y; });
						});
	</script>
</body>

</html>