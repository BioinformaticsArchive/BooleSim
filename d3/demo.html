<html>

<head>
	<script src="d3.v2.js"></script>
	<script>
	input = '{"nodes":[{"id":"glucose"},{"id":"glycerol"}], "edges":[{"source":"glucose", "target":"glycerol"}]}';
	network = JSON.parse(input);
	</script>
	<style>
	.node	{
			stroke: #fff;
			stroke-width: 1.5px;
			fill: transparent;
			}
	.edge	{
			stroke: #999;
			stroke-opacity: .6;
			stroke-width: 1.6px;
			}
	.node_rect	{
				fill: green;
				}
	.node_text	{
				fill: black;
				font-family: Arial;
				}
	</style>
</head>

<body>
	<script>
	var	width = 960,
		height = 900;

	var color = d3.scale.category20();

	var force = d3.layout.force()
						.charge(-500)
						.linkDistance(50)
						.size([width, height]);

	var svg = d3.select("body").append("svg")
								.attr("width", width)
								.attr("height", height);

	console.log(network.nodes.length+' nodes')
	console.log(network.edges.length+' edges');

	arrow = svg.append("defs").append("marker");
	arrow.attr('id', 'arrow').attr('orient', 'auto').attr('markerWidth', 10).attr('markerHeight', 10).attr('refX', 20).attr('refY', 3);
	arrow.append('path').attr('d', 'M0,0 V6 L4,3 Z').attr('fill', 'blue');

	for (i in network.nodes) {
		n = network.nodes[i];
		n.index = i;
		n.x = 10;
		n.y = 10;
		n.px = 1;
		n.py = 1;
		n.fixed = false;
		n.weight = 1;
		}

	function getNodeById(id) {
		for (i in network.nodes) {
			if (network.nodes[i].id == id || network.nodes[i] == id)
				return network.nodes[i];
			}
		console.error('node '+id+' not found. created.');
		return network.nodes.append( {'index':network.nodes.length, 'x':1, 'y':1, 'fixed':false} );
		}

	//
	// d3 expects edge source and targets specified as object links, rather than ids or indices
	//
	for (i in network.edges) {
		network.edges[i].sourceNode = getNodeById(network.edges[i].source);
		network.edges[i].targetNode = getNodeById(network.edges[i].target);
		}

	// import data to d3 force-directed layouting
	force
	      .nodes(network.nodes)
	      .links(network.edges)
	      .start();

	var edges = svg.selectAll("line.edge")
					.data(network.edges).enter()
						.append("line")
						.attr("class", "edge");		// add class link for application of css style attributes
	edges.attr('marker-end', 'url(#arrow)');
	
	var w = 70;
	var h = 30;
	var nodes = svg.selectAll("g").data(network.nodes)	// selectAll.data = apply the data in network.nodes to the selected svg elements, which already exist
										.enter()	// for remaining unapplied data do:
											.append("g")
												.attr("class", "bbox");
	nodes	.call(force.drag);

	var circles =	nodes
					.append("rect")
					.attr("class", "node_rect")
					.attr("width", w)
					.attr("height",  h)
					.attr("rx", 5);

	var titles =	nodes
					.append("text")
					.attr("class", "node_text")
					.attr("transform", "translate(10, "+h/2+")")
					.text( function(data) { return data.id; } );

	  /*nodes.append("title").text(
						function(n) { return n.id; }
						);
						*/

	  force.on("tick", function() {
						    edges	.attr("x1", function(data) { return data.sourceNode.x+w/2; })
								.attr("y1", function(data) { return data.sourceNode.y+h/2; })
								.attr("x2", function(data) { return data.targetNode.x+w/2; })
								.attr("y2", function(data) { return data.targetNode.y+h/2; });

						    circles	.attr("x", function(data) { return data.x; })
								.attr("y", function(data) { return data.y; });

						    titles	.attr("x", function(data) { return data.x; })
								.attr("y", function(data) { return data.y; });
						});
	</script>
</body>

</html>